package com.docbrief.summary.ai;

import lombok.Data;
import lombok.RequiredArgsConstructor;
import org.springframework.boot.CommandLineRunner;
import org.springframework.format.annotation.DateTimeFormat;
import org.springframework.stereotype.Component;

import javax.swing.text.DateFormatter;
import java.time.Duration;
import java.time.Instant;
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;
import java.util.Date;

@Component
@RequiredArgsConstructor
public class AnalysisApiTestRunner implements CommandLineRunner {

    private final AnalysisClient analysisClient;
    private final PromptBuilder promptBuilder;

    @Override
    public void run(String... args) {
        LocalDateTime date = null;

        DateTimeFormatter formatter =
                DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss");


        String documentText = """
                {
                    "fullText": "정부가 6·3 지방선거를 앞두고 대전·충남, 광주·전남 특별시에 인센티브로 각각 연 최대 5조원씩 4년간 총 40조원을 주겠다고 16일 밝혔다. 또 서울특별시에 준하는 지위를 주고, 내년에 시작되는 수도권 공공기관 2차 지방 이전에서 대상 지역으로 우선적으로 고려하겠다고 했다.\\n\\n더불어민주당과 정부는 이날 아침 고위당정협의회를 열어 이 같은 방안을 확정했다. 김민석 국무총리는 이를 발표하면서 “지역 주민이 체감할 수 있는 파격적인 인센티브를 마련했다”고 했다. 대전·충남과 광주·전남의 올해 예산은 각각 19조5210억원, 20조3846억원이다. 이를 내년부터 약 25%씩 늘려주겠다는 것이다.\\n\\n이런 대규모 지원은 최근 갑자기 결정된 것으로 알려졌다. 당초 정부 측은 일부 여야 국회의원에게 대전과 충남에 각각 연 1조2000억원가량 지원하는 통합 인센티브안을 비공개로 설명했다고 한다. 그러나 청와대 지시로 지원 규모가 2배 이상으로 늘었고, 광주·전남도 연 5조원을 받게 된 것으로 알려졌다. 하지만 정부는 이날 이같은 재원을 어떻게 마련할지에 대해선 설명하지 못했다.\\n\\n야권에서는 “선거용 매표 행위”라는 비판이 나왔다. 대전·충남 통합은 국민의힘 소속 현 단체장들이 추진했는데, 이 대통령이 지난달 5일 충남 천안에서 열린 타운홀미팅에서 이 지역 통합론을 꺼내면서 주요 이슈로 떠올랐다. 이후 민주당은 “6월 지방선거 때 통합 단체장을 뽑을 수 있게 하겠다”며 관련 특별법 발의 등에 속도를 냈다. 민주당이 모든 의석을 가진 광주·전남 통합도 급진전됐다.\\n\\n국민의힘 박성훈 수석대변인은 “파격적인 지원책을 내놨다지만 내용을 뜯어보면 지방이 요구해온 권한·재정 이양은 빠진 반쪽짜리 통합”이라며 “선거를 위한 성급한 지원 방안과 정치적 계산이 앞선 정부 발표를 규탄한다”고 했다.\\n\\n“통합시, 특혜 수준 지원“… 다른 예산 10조 줄여 재원 만든다는 정부\\n\\n이재명 대통령은 16일 여야 지도부와의 오찬에서 행정 통합을 꺼내며 여야 협조를 당부했다. 이 대통령은 “지역 균형 발전 측면에서 광역 도시들이 탄생하면 국제적 경쟁에서도 유리하고 지역 균형 발전에도 큰 계기가 될 수 있기 때문에 힘을 모아 달라”고 했다. “최대한의 인센티브를 보장하려고 한다”고도 했다.\\n\\n김민석 총리는 이날 대전·충남, 광주·전남 통합 특별시 40조원 지원 계획을 발표하면서 “파격적인 재정 방안”이라고 했다. 이에 대해 국무총리실 관계자는 “특혜 수준의 지원”이라고 했다. 정부는 이 지원안을 담은 특별법안을 6·3 지방선거 전에 처리할 예정이다. 이를 위해 입법 예고와 각종 영향 평가, 차관·국무회의 심의 등으로 3개월 넘게 걸리는 정부 입법 절차를 건너뛰고 법안을 여당 의원 명의로 발의할 방침이다. 이렇게 되면 이 법안은 다음 달 내 국회 본회의에서 통과된다.\\n\\n정부는 대전·충남과 광주·전남에 4년간 40조원을 더 주기 위해, 중앙정부가 거둔 내국세 일반세 수입의 19.24%를 떼어주게 돼 있는 지방교부세와 별개의 교부세를 만들기로 했다. 가칭 ‘행정 통합 교부세’를 새로 만들어, 이 명목으로 연 최대 5조원씩을 주기로 했다.\\n\\n하지만 정부는 이날 막대한 재원을 어떻게 마련할지에 대해선 구체적으로 설명하지 않았다. 민주당이 공개한 법안에도 이 내용은 포함되지 않았다. 정부 관계자는 “조만간 따로 설명하는 자리를 마련할 것”이라고만 했다.\\n\\n일단 정부는 재원은 중앙정부 지출을 연 최대 10조원 줄이는 ‘지출 구조조정’을 통해 마련할 계획으로 알려졌다. 정부는 올해 예산을 편성하면서 27조원을 지출 구조조정으로 마련했다고 밝혔는데, 내년부터는 10조원을 더 아껴서 통합 특별시에 주겠다는 것이다. 하지만 정부 내에서도 비현실적이라는 말이 나온다. 여권 관계자는 “결국 적자 국채를 더 찍게 될 것”이라고 했다.\\n\\n정부는 또 통합 특별시에 행정 조직과 공무원 인사 특례를 주기로 했다. 현재 시·도지사 가운데 서울시장만 장관급, 나머지는 차관급 예우를 받는다. 또 서울시만 차관급 부시장을 3명 두고, 나머지 시·도의 부시장·부지사는 1급이다. 지방자치 사무를 맡은 행정안전부와 격을 맞추기 위한 것이다. 그러나 통합 특별시는 부시장을 서울시보다도 많은 4명을 둘 수 있게 하고, 모두 차관급으로 격상하기로 했다. 이에 따라 통합 특별시장들도 사실상 장관급 예우를 받게 된다. 부시장 아래에 있는 핵심 보직도 2급에서 1급으로 덩달아 오른다. 직제 개편과 소속 공무원 선발·임용·승진도 자율적으로 할 수 있게 된다.\\n\\n정부는 2019년 이후 중단됐으나 내년부터 재추진되는 공공기관 지방 이전 2단계 사업에서는 통합 특별시들을 이전 대상 지역으로 우선적으로 고려하기로 했다. 구체적으로 어느 기관을 어디로 이전할지는 추후 논의를 통해 확정하기로 했지만, 공공기관 유치를 두고 다른 지역과 경쟁했던 대전·충남과 광주·전남 모두 경쟁에서 우위에 서게 될 것으로 전망된다.\\n\\n정부는 통합 특별시에 입주하는 기업에도 고용 보조금과 교육·훈련 지원금을 주고, 토지 임대료 감면과 각종 개발 사업에 대한 지방세 감면 제공도 추진하기로 했다. 통합 특별시 내 투자진흥지구, 문화산업진흥지구 등에 대해서는 다른 지역 지구보다 지원을 더 해주고, 개발 사업 승인을 비롯한 각종 행정 절차도 간소화하기로 했다.\\n\\n하지만 국민의힘 요구는 상당 부분 빠졌다. 10년간 투자 심사, 예비 타당성 조사, 타당성 조사 등을 면제해 줄 것과 개발제한구역 지정·해제 권한, 외국인 전용 카지노 허가 권한, 우버 택시 허용 권한을 줄 것 등이다. 국민의힘 소속 현 단체장들은 “일시적 지원”이라며 실망스럽다고 했다. 이장우 대전시장은 “대통령의 과감한 권한 이양과 지원 약속에 비해 기대에 못 미친다”고 했고, 김태흠 충남지사는 “우리가 요구한 257개 특례 조항에 비해 정부의 지원안이 미흡하다”고 했다.\\n\\n부산·경남도 반발했다. 이 지역은 최근 공론화위원회가 통합 로드맵까지 발표했지만 인센티브 제공에서 제외됐다. 부산은 “행정 통합은 실질적 재정 분권과 사무 분권이 담보돼야 한다”고 했고, 경남은 주민 주도가 아닌 정부 주도 행정 통합에 우려를 표했다."
                    "paragraphs": [
                    {
                      "order": 1,
                      "sentences": [
                        { "order": 1, "text": "정부가 6·3 지방선거를 앞두고 대전·충남, 광주·전남 특별시에 인센티브로 각각 연 최대 5조원씩 4년간 총 40조원을 주겠다고 16일 밝혔다." },
                        { "order": 2, "text": "또 서울특별시에 준하는 지위를 주고, 내년에 시작되는 수도권 공공기관 2차 지방 이전에서 대상 지역으로 우선적으로 고려하겠다고 했다." }
                      ]
                    },
                    {
                      "order": 2,
                      "sentences": [
                        { "order": 1, "text": "더불어민주당과 정부는 이날 아침 고위당정협의회를 열어 이 같은 방안을 확정했다." },
                        { "order": 2, "text": "김민석 국무총리는 이를 발표하면서 “지역 주민이 체감할 수 있는 파격적인 인센티브를 마련했다”고 했다." },
                        { "order": 3, "text": "대전·충남과 광주·전남의 올해 예산은 각각 19조5210억원, 20조3846억원이다." },
                        { "order": 4, "text": "이를 내년부터 약 25%씩 늘려주겠다는 것이다." }
                      ]
                    },
                    {
                      "order": 3,
                      "sentences": [
                        { "order": 1, "text": "이런 대규모 지원은 최근 갑자기 결정된 것으로 알려졌다." },
                        { "order": 2, "text": "당초 정부 측은 일부 여야 국회의원에게 대전과 충남에 각각 연 1조2000억원가량 지원하는 통합 인센티브안을 비공개로 설명했다고 한다." },
                        { "order": 3, "text": "그러나 청와대 지시로 지원 규모가 2배 이상으로 늘었고, 광주·전남도 연 5조원을 받게 된 것으로 알려졌다." },
                        { "order": 4, "text": "하지만 정부는 이날 이같은 재원을 어떻게 마련할지에 대해선 설명하지 못했다." }
                      ]
                    },
                    {
                      "order": 4,
                      "sentences": [
                        { "order": 1, "text": "야권에서는 “선거용 매표 행위”라는 비판이 나왔다." },
                        { "order": 2, "text": "대전·충남 통합은 국민의힘 소속 현 단체장들이 추진했는데, 이 대통령이 지난달 5일 충남 천안에서 열린 타운홀미팅에서 이 지역 통합론을 꺼내면서 주요 이슈로 떠올랐다." },
                        { "order": 3, "text": "이후 민주당은 “6월 지방선거 때 통합 단체장을 뽑을 수 있게 하겠다”며 관련 특별법 발의 등에 속도를 냈다." },
                        { "order": 4, "text": "민주당이 모든 의석을 가진 광주·전남 통합도 급진전됐다." }
                      ]
                    },
                    {
                      "order": 5,
                      "sentences": [
                        { "order": 1, "text": "국민의힘 박성훈 수석대변인은 “파격적인 지원책을 내놨다지만 내용을 뜯어보면 지방이 요구해온 권한·재정 이양은 빠진 반쪽짜리 통합”이라며 “선거를 위한 성급한 지원 방안과 정치적 계산이 앞선 정부 발표를 규탄한다”고 했다." }
                      ]
                    },
                    {
                      "order": 6,
                      "sentences": [
                        { "order": 1, "text": "“통합시, 특혜 수준 지원“… 다른 예산 10조 줄여 재원 만든다는 정부" }
                      ]
                    },
                    {
                      "order": 7,
                      "sentences": [
                        { "order": 1, "text": "이재명 대통령은 16일 여야 지도부와의 오찬에서 행정 통합을 꺼내며 여야 협조를 당부했다." },
                        { "order": 2, "text": "이 대통령은 “지역 균형 발전 측면에서 광역 도시들이 탄생하면 국제적 경쟁에서도 유리하고 지역 균형 발전에도 큰 계기가 될 수 있기 때문에 힘을 모아 달라”고 했다." },
                        { "order": 3, "text": "“최대한의 인센티브를 보장하려고 한다”고도 했다." }
                      ]
                    },
                    {
                      "order": 8,
                      "sentences": [
                        { "order": 1, "text": "김민석 총리는 이날 대전·충남, 광주·전남 통합 특별시 40조원 지원 계획을 발표하면서 “파격적인 재정 방안”이라고 했다." },
                        { "order": 2, "text": "이에 대해 국무총리실 관계자는 “특혜 수준의 지원”이라고 했다." },
                        { "order": 3, "text": "정부는 이 지원안을 담은 특별법안을 6·3 지방선거 전에 처리할 예정이다." },
                        { "order": 4, "text": "이를 위해 입법 예고와 각종 영향 평가, 차관·국무회의 심의 등으로 3개월 넘게 걸리는 정부 입법 절차를 건너뛰고 법안을 여당 의원 명의로 발의할 방침이다." },
                        { "order": 5, "text": "이렇게 되면 이 법안은 다음 달 내 국회 본회의에서 통과된다." }
                      ]
                    },
                    {
                      "order": 9,
                      "sentences": [
                        { "order": 1, "text": "정부는 대전·충남과 광주·전남에 4년간 40조원을 더 주기 위해, 중앙정부가 거둔 내국세 일반세 수입의 19.24%를 떼어주게 돼 있는 지방교부세와 별개의 교부세를 만들기로 했다." },
                        { "order": 2, "text": "가칭 ‘행정 통합 교부세’를 새로 만들어, 이 명목으로 연 최대 5조원씩을 주기로 했다." }
                      ]
                    },
                    {
                      "order": 10,
                      "sentences": [
                        { "order": 1, "text": "하지만 정부는 이날 막대한 재원을 어떻게 마련할지에 대해선 구체적으로 설명하지 않았다." },
                        { "order": 2, "text": "민주당이 공개한 법안에도 이 내용은 포함되지 않았다." },
                        { "order": 3, "text": "정부 관계자는 “조만간 따로 설명하는 자리를 마련할 것”이라고만 했다." }
                      ]
                    },
                    {
                      "order": 11,
                      "sentences": [
                        { "order": 1, "text": "일단 정부는 재원은 중앙정부 지출을 연 최대 10조원 줄이는 ‘지출 구조조정’을 통해 마련할 계획으로 알려졌다." },
                        { "order": 2, "text": "정부는 올해 예산을 편성하면서 27조원을 지출 구조조정으로 마련했다고 밝혔는데, 내년부터는 10조원을 더 아껴서 통합 특별시에 주겠다는 것이다." },
                        { "order": 3, "text": "하지만 정부 내에서도 비현실적이라는 말이 나온다." },
                        { "order": 4, "text": "여권 관계자는 “결국 적자 국채를 더 찍게 될 것”이라고 했다." }
                      ]
                    },
                    {
                      "order": 12,
                      "sentences": [
                        { "order": 1, "text": "정부는 또 통합 특별시에 행정 조직과 공무원 인사 특례를 주기로 했다." },
                        { "order": 2, "text": "현재 시·도지사 가운데 서울시장만 장관급, 나머지는 차관급 예우를 받는다." },
                        { "order": 3, "text": "그러나 통합 특별시는 부시장을 서울시보다도 많은 4명을 둘 수 있게 하고, 모두 차관급으로 격상하기로 했다." },
                        { "order": 4, "text": "이에 따라 통합 특별시장들도 사실상 장관급 예우를 받게 된다." },
                        { "order": 5, "text": "직제 개편과 소속 공무원 선발·임용·승진도 자율적으로 할 수 있게 된다." }
                      ]
                    },
                    {
                      "order": 13,
                      "sentences": [
                        { "order": 1, "text": "정부는 내년부터 재추진되는 공공기관 지방 이전 2단계 사업에서는 통합 특별시들을 이전 대상 지역으로 우선적으로 고려하기로 했다." }
                      ]
                    },
                    {
                      "order": 14,
                      "sentences": [
                        { "order": 1, "text": "정부는 통합 특별시에 입주하는 기업에도 고용 보조금과 교육·훈련 지원금을 주고, 토지 임대료 감면과 각종 개발 사업에 대한 지방세 감면 제공도 추진하기로 했다." }
                      ]
                    },
                    {
                      "order": 15,
                      "sentences": [
                        { "order": 1, "text": "하지만 국민의힘 요구는 상당 부분 빠졌다." },
                        { "order": 2, "text": "국민의힘 소속 현 단체장들은 “일시적 지원”이라며 실망스럽다고 했다." }
                      ]
                    },
                    {
                      "order": 16,
                      "sentences": [
                        { "order": 1, "text": "부산·경남도 반발했다." },
                        { "order": 2, "text": "부산은 “행정 통합은 실질적 재정 분권과 사무 분권이 담보돼야 한다”고 했고, 경남은 주민 주도가 아닌 정부 주도 행정 통합에 우려를 표했다." }
                      ]
                    }
                  ]
                }
                """;
        System.out.println("원문 documentText");
        System.out.println(documentText);

        // 요청 시작
        date = LocalDateTime.now();
        Instant start = Instant.now();
        System.out.println("Gemini Request ::: " + date.format(formatter));
        String prompt = promptBuilder.buildSummaryPrompt(documentText); //documentText 원문 내용
        String result = analysisClient.summarize(
                prompt
        );

        // 요청 끝
        date = LocalDateTime.now();
        Instant end = Instant.now();

        Duration duration = Duration.between(start, end);
        System.out.println("Gemini Response ::: " + date.format(formatter));
        System.out.println("소요시간 s ::: " + duration.toSeconds() + " / ms ::: " + duration.toMillis());
        System.out.println("Summary Result ================================================");
        System.out.println(result);
        System.out.println("===============================================================");
    }
}
